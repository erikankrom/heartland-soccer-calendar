---
phase: 04-modify-field-map-link-location
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/index.js]
autonomous: false
---

<objective>
Change the subscribe page so the field name text is a clickable link to the field map (when available), replacing the separate static "Field map" link. The park/complex location text stays unlinked.

Purpose: Improves UX by making the natural clickable target (the field name) the link rather than a generic "Field map" label, while keeping the park name as pure context text.
Output: Updated client-side JS in src/index.js; no new files, no new CSS.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make field name the map link in subscribe page JS</name>
  <files>src/index.js</files>
  <action>
In the client-side JS inside `renderSubscribePage` (the `data.events.forEach` block, around the `locLabel`/`mapLink` variables), change the field location rendering as follows:

**Current code (two variables, ~lines 927–928):**
```javascript
var locLabel = loc && loc.name ? esc(loc.field + ' \u2014 ' + loc.name) : (loc && loc.field ? esc(loc.field) : '');
var mapLink = (loc && loc.mapUrl) ? '<div class="meta"><a href="' + esc(loc.mapUrl) + '" target="_blank" rel="noopener">Field map</a></div>' : '';
```

**Replace with:**
```javascript
var fieldAnchor = (loc && loc.field)
  ? (loc.mapUrl
      ? '<a href="' + esc(loc.mapUrl) + '" target="_blank" rel="noopener">' + esc(loc.field) + '</a>'
      : esc(loc.field))
  : '';
var locLabel = fieldAnchor
  ? (loc && loc.name ? fieldAnchor + ' \u2014 ' + esc(loc.name) : fieldAnchor)
  : '';
var mapLink = '';
```

**Rules:**
- Use `esc()` on ALL user-derived values inserted into HTML (`loc.mapUrl`, `loc.field`, `loc.name`) — this is the existing XSS pattern in this file, do not deviate.
- `mapLink` is set to `''` (empty string) — the variable is still referenced in the `html +=` line below, so keep the declaration.
- The `locLabel` value now contains HTML (an anchor tag), not plain text. It is placed inside `<div class="meta">` in the `html +=` concatenation — this is intentional and safe because the anchor and text content are escaped.
- Do not change the `.meta` class, the `jerseyHtml`, the time, title, or any other part of the event row HTML.
- Do not add new CSS or change styling.
  </action>
  <verify>Run `npm run dev` (wrangler dev) and visit `/subscribe/{anyTeamId}`. Confirm the event rows show the field name as a clickable link and no separate "Field map" line appears. If no live server, inspect the generated HTML in the JS string to confirm the anchor wraps `loc.field` and `loc.name` is outside the `<a>` tag.</verify>
  <done>
- `locLabel` emits `<a href="...">OSC 7A</a> — GARMIN Olathe Soccer Complex` when mapUrl exists
- `locLabel` emits `OSC 7A — GARMIN Olathe Soccer Complex` (plain text) when no mapUrl
- No separate "Field map" div rendered in any event row
- `esc()` applied to `loc.mapUrl`, `loc.field`, and `loc.name`
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Subscribe page event rows now show field name as the map link; no separate "Field map" label</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: `http://localhost:8787/subscribe/{yourTeamId}` (use a real team ID)
    3. Scroll to "Upcoming games" section
    4. For a game with a known field (e.g. OSC or OP prefix):
       - Confirm the field name text (e.g. "OSC 7A — GARMIN Olathe Soccer Complex") is rendered as a link on the field code portion only ("OSC 7A" is the link, "GARMIN Olathe Soccer Complex" is plain text after the em dash)
       - Confirm clicking the field name opens the map link
       - Confirm there is NO separate "Field map" line below it
    5. For a game with no mapUrl in locations.csv:
       - Confirm the field text is plain (unlinked), no "Field map" line
    6. Confirm jersey color line still appears below location
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] Event rows with a field mapUrl show the field name as a clickable link
- [ ] Complex/park name is NOT a link (appears after em dash as plain text)
- [ ] No "Field map" label visible anywhere in event rows
- [ ] Event rows without a mapUrl show plain unlinked field text (no regression)
- [ ] Jersey color meta line still present below location
</verification>

<success_criteria>

- All tasks completed
- Field name is the map link when mapUrl available; park name is unlinked
- No separate "Field map" div rendered
- XSS safety preserved (esc() used on all dynamic values in HTML)
- No new CSS or markup structure changes
  </success_criteria>

<output>
After completion, create `.planning/phases/04-modify-field-map-link-location/04-01-SUMMARY.md`
</output>
