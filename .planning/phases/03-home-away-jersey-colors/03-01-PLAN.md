---
phase: 03-home-away-jersey-colors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/index.js]
autonomous: false
---

<objective>
Add home/away jersey color assignment to iCal events and the subscribe page event rows.

Purpose: Per Heartland official rules, home team (listed first) wears white/light jerseys; away team (listed second) wears dark jerseys. Surfacing this in calendar events and the subscribe page preview saves families from showing up in the wrong color.

Output: Each game in the iCal DESCRIPTION and the subscribe page event row shows either "Home — White/Light jerseys" or "Away — Dark jerseys" derived from the subscribed team's position in the SUMMARY field.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add jersey color line to iCal DESCRIPTION</name>
  <files>src/index.js</files>
  <action>
In `generateICal(events, teamId, teamName, sourceUrl)`, for each VEVENT determine home/away by testing the event's `summary` against a numeric regex:

```js
const isHome = new RegExp('^\\s*' + teamId + '\\s*[-–]').test(e.summary || '');
const jerseyColor = isHome ? 'Home — White/Light jerseys' : 'Away — Dark jerseys';
```

Then push `jerseyColor` into `descParts` **after** the field map URL line (or at the end of descParts if no field info). The final DESCRIPTION reads like:
```
Field: OSC 7A
GARMIN Olathe Soccer Complex
Field map: https://...
Home — White/Light jerseys
```

Location in code: inside the `for (const e of events)` loop, just before the `if (descParts.length > 0)` check. Always push `jerseyColor` — every event has a home/away assignment.

Do NOT modify anything outside `generateICal`. Do NOT touch `LOCATION` or `X-APPLE-STRUCTURED-LOCATION`.
  </action>
  <verify>Search for `jerseyColor` in src/index.js and confirm it appears once; confirm `descParts.push(jerseyColor)` is inside the event loop.</verify>
  <done>Every VEVENT's DESCRIPTION ends with either "Home — White/Light jerseys" or "Away — Dark jerseys".</done>
</task>

<task type="auto">
  <name>Task 2: Add jersey color meta line to subscribe page event rows</name>
  <files>src/index.js</files>
  <action>
In `renderSubscribePage()`, inside the inline `<script>` block, find the `data.events.forEach(function(e) { ... })` loop. Add home/away detection using the already-available `TEAM_ID` variable:

```js
var isHome = new RegExp('^\\s*' + TEAM_ID + '\\s*[-–]').test(e.summary || '');
var jerseyHtml = '<div class="meta">' + (isHome ? 'Home \u2014 White/Light jerseys' : 'Away \u2014 Dark jerseys') + '</div>';
```

Then include `jerseyHtml` in the event row HTML string, after the `mapLink` div and before the closing `</div></div>` of the row.

The current row-building line (line ~924) looks like:
```js
html += '<div class="event-row"><div class="event-date">...' + mapLink + '</div></div>';
```

Insert `jerseyHtml` after `mapLink`:
```js
html += '...' + mapLink + jerseyHtml + '</div></div>';
```

Use the Unicode escape `\u2014` for the em dash (already used in the existing `\u2013` pattern nearby).

Do NOT change CSS — `.meta` class already provides the correct dimmed styling (font-size .85rem, color var(--text-dim)).
  </action>
  <verify>Search for `jerseyHtml` in src/index.js and confirm it appears in both the variable definition and the html concatenation.</verify>
  <done>Each event row on the subscribe page shows a gray "Home — White/Light jerseys" or "Away — Dark jerseys" line below the map link.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Home/away jersey colors added to iCal DESCRIPTION and subscribe page event rows</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:8787/subscribe/{your-team-id} (use any valid team ID)
    3. Scroll to "Upcoming games" — each event row should show a gray meta line: "Home — White/Light jerseys" or "Away — Dark jerseys"
    4. Verify the colors alternate realistically (some home, some away) — not all the same
    5. Check the iCal feed: Visit http://localhost:8787/calendar/{your-team-id} and confirm the raw text for each VEVENT contains "Home — White/Light jerseys" or "Away — Dark jerseys" in the DESCRIPTION field
    6. Confirm the jersey line appears AFTER the field map URL (if present) in the DESCRIPTION
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -n "jerseyColor" src/index.js` returns a result inside generateICal
- [ ] `grep -n "jerseyHtml" src/index.js` returns results in the forEach loop
- [ ] `npm run dev` starts without error
- [ ] Subscribe page event rows show jersey color for each game
- [ ] iCal DESCRIPTION includes jersey color line
</verification>

<success_criteria>
- iCal DESCRIPTION for every VEVENT ends with jersey assignment
- Subscribe page event rows each display the correct home/away jersey color
- Home detection: teamId appears at start of SUMMARY (before first "vs")
- Away detection: teamId does not appear at start of SUMMARY
- No regressions: field name, address, field map link all still present
- No new CSS needed — .meta class handles styling
</success_criteria>

<output>
After completion, create `.planning/phases/03-home-away-jersey-colors/03-01-SUMMARY.md`
</output>
